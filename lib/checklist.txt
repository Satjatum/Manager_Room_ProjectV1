# 🏗️ โครงสร้างระบบจัดการหอพัก - ลำดับการพัฒนา

## 📋 Phase 1: ระบบพื้นฐาน (Foundation)
**ต้องทำก่อนเพราะเป็นข้อมูลหลักที่ระบบอื่นต้องใช้**

### 1.1 ระบบ Authentication & Authorization ⭐ **เริ่มที่นี่**
- [ ] หน้า Login
- [ ] หน้า Register (สำหรับ superadmin สร้าง admin)
- [ ] การจัดการ Session
- [ ] Middleware ตรวจสอบสิทธิ์

**เหตุผล:** ต้องมีระบบล็อกอินก่อนถึงจะใช้งานระบบอื่นได้

---

### 1.2 ระบบจัดการผู้ใช้ (User Management)
- [ ] หน้ารายการผู้ใช้
- [ ] หน้าเพิ่ม/แก้ไข/ลบผู้ใช้
- [ ] กำหนดบทบาท (Role) และสิทธิ์ (Permissions)
- [ ] ดูประวัติการเข้าสู่ระบบ

**เหตุผล:** ต้องมีผู้ดูแลระบบก่อนจึงจะจัดการข้อมูลต่อไปได้

---

### 1.3 ระบบจัดการสาขา (Branch Management) ⭐ **สำคัญมาก**
- [ ] หน้ารายการสาขา
- [ ] หน้าเพิ่ม/แก้ไข/ลบสาขา
- [ ] อัปโหลดรูปภาพสาขา
- [ ] กำหนดผู้จัดการสาขา (Branch Managers)
- [ ] ดูรายละเอียดสาขาพร้อมสถิติ

**เหตุผล:** ข้อมูลห้อง, อัตราค่าบริการ, การตั้งค่าต่างๆ ต้องผูกกับสาขา

---

### 1.4 ข้อมูลพื้นฐานสำหรับห้อง (Room Master Data)
- [ ] จัดการ**ประเภทห้อง** (Room Types)
  - ห้องพัดลม, ห้องแอร์, Studio, 1 Bedroom
- [ ] จัดการ**หมวดหมู่ห้อง** (Room Categories)
  - ห้องเดี่ยว, ห้องคู่, ห้องครอบครัว
- [ ] จัดการ**สิ่งอำนวยความสะดวก** (Amenities)
  - แอร์, WiFi, ตู้เสื้อผ้า, เครื่องทำน้ำอุ่น

**เหตุผล:** ต้องมีข้อมูลเหล่านี้ก่อนถึงจะสร้างห้องได้

---

## 📋 Phase 2: ระบบจัดการหลัก (Core Operations)

### 2.1 ระบบจัดการห้อง (Room Management) ⭐ **สำคัญมาก**
- [ ] หน้ารายการห้องทั้งหมด (แบบตาราง/การ์ด)
- [ ] กรองห้องตามสาขา, สถานะ, ประเภท
- [ ] หน้าเพิ่มห้องใหม่
  - เลือกสาขา, หมายเลขห้อง, ประเภท, หมวดหมู่
  - กำหนดราคาเช่า, ค่าประกัน
  - เพิ่มสิ่งอำนวยความสะดวก
  - อัปโหลดรูปภาพห้อง
- [ ] หน้าแก้ไขข้อมูลห้อง
- [ ] เปลี่ยนสถานะห้อง (ว่าง/มีผู้เช่า/ซ่อมบำรุง/จอง)
- [ ] ดูรายละเอียดห้องแบบเต็ม

**เหตุผล:** ต้องมีห้องก่อนถึงจะให้เช่าได้

---

### 2.2 ระบบจัดการผู้เช่า (Tenant Management)
- [ ] หน้ารายการผู้เช่า
- [ ] หน้าเพิ่มผู้เช่าใหม่
  - ข้อมูลส่วนตัว (ชื่อ, เลขบัตร, เบอร์โทร)
  - อัปโหลดรูปโปรไฟล์
  - สร้าง User Account (ถ้าต้องการให้เข้าระบบได้)
- [ ] หน้าแก้ไขข้อมูลผู้เช่า
- [ ] ดูประวัติการเช่า
- [ ] ดูประวัติการชำระเงิน
- [ ] ดูประวัติการแจ้งปัญหา

**เหตุผล:** ต้องมีข้อมูลผู้เช่าก่อนจะทำสัญญาเช่า

---

### 2.3 ระบบสัญญาเช่า (Contract Management)
- [ ] หน้ารายการสัญญา
- [ ] หน้าสร้างสัญญาใหม่
  - เลือกห้อง (ที่ว่าง)
  - เลือกผู้เช่า
  - กำหนดวันเริ่มต้น-สิ้นสุด
  - กำหนดราคาเช่า, ค่าประกัน
  - กำหนดวันชำระเงินประจำเดือน
  - อัปโหลดเอกสารสัญญา
- [ ] หน้าแก้ไขสัญญา
- [ ] ต่อสัญญา
- [ ] ยกเลิกสัญญา (Terminate)
- [ ] ดูสถานะสัญญา (Active/Expired/Terminated)

**เหตุผล:** หลังจากมีห้องและผู้เช่าแล้ว ต้องทำสัญญาก่อนเก็บค่าเช่า

---

## 📋 Phase 3: ระบบเงินและการเก็บค่าใช้จ่าย (Financial)

### 3.1 ระบบตั้งค่าค่าบริการ (Utility Settings) ⭐ **ทำก่อนออกบิล**
- [ ] หน้าจัดการอัตราค่าบริการ (Utility Rates)
  - ค่าไฟฟ้า (ราคา/หน่วย)
  - ค่าน้ำ (ราคา/หน่วย)
  - ค่าส่วนกลาง (คงที่)
  - ค่าอินเทอร์เน็ต (คงที่)
- [ ] หน้าตั้งค่าค่าปรับและส่วนลด (Payment Settings)
  - เปิด/ปิดค่าปรับชำระล่าช้า
  - กำหนดอัตราค่าปรับ (คงที่/เปอร์เซ็นต์/รายวัน)
  - เปิด/ปิดส่วนลดชำระก่อนกำหนด
  - กำหนดเปอร์เซ็นต์ส่วนลด

**เหตุผล:** ต้องตั้งค่าราคาต่างๆ ก่อนจะสร้างบิลได้

---

### 3.2 ระบบบันทึกค่ามิเตอร์ (Meter Reading)
- [ ] หน้าดูประวัติค่ามิเตอร์ 
- Superadmin ดูได้ทุกสาขา
- Admin จะโชว์แค่สาขาที่ตัวเองดูแล 
- Tenant ดูได้แค่ของห้องตัวเอง
- [ ] หน้าบันทึกค่ามิเตอร์รายเดือน
  - เลือกห้อง
  - ระบุเดือน/ปี
  - อัปโหลดรูปภาพมิเตอร์ (ต้องมีการเปลี่ยนชื่อรูปก่อนเก็บเข้า bucket supabase ใช้ image_service)
  - กรอกมิเตอร์น้ำเดือน (หากมีค่าเดือนก่อนให้ดึงมาอัตโนมัติถ้าไม่มีก็กรอกปกติ)- มิเตอร์น้ำเดือนล่าสุด = หน่วยของมิเตอร์น้ำ (คำนวณหน่วยอัตโนมัตโดยการเอาเดือนก่อน - เดือนล่าสุด)
  - กรอกมิเตอร์ไฟเดือน (หากมีค่าเดือนก่อนให้ดึงมาอัตโนมัติถ้าไม่มีก็กรอกปกติ) - มิเตอร์ไฟเดือนล่าสุด = หน่วยของมิเตอร์ไฟ (คำนวณหน่วยอัตโนมัตโดยการเอาเดือนก่อน - เดือนล่าสุด)
- [ ] หน้าแก้ไขค่ามิเตอร์
- [ ] เมื่อทุกอย่างเรียบร้อยจะมีปุ่มให้กดสร้างบิลค์
ข้อให้มีฟีเจอร์
- ฉันแนบ Ui ตัวอย่าง issuelist_ui.dart ให้แล้ว
- ฉันแนบ Schema Database ให้แล้วชื่อว่า backupdatabase
- รองรับทั้ง Mobile และ Web โดยใช้ Media Query(context)

**เหตุผล:** ต้องอ่านมิเตอร์ก่อนจะสร้างบิลได้

---

### 3.3 ระบบออกบิล (Invoice Management) ⭐ **ใจกลางของระบบเงิน**
- [ ] หน้าสร้างบิลรายเดือน (สร้างทีละห้อง หรือ สร้างครั้งละหลายห้อง)
  - เลือกสัญญา/ห้อง
  - เลือกเดือน/ปี
  - ดึงค่าเช่าจากสัญญา
  - ดึงค่ามิเตอร์อัตโนมัติ (ไฟ, น้ำ)
  - เพิ่มค่าคงที่ (ค่าส่วนกลาง, เน็ต)
  - เพิ่มค่าใช้จ่ายอื่นๆ (ค่าปรับ, ค่าซ่อม)
  - ใส่ส่วนลด (ถ้ามี)
  - กำหนดวันครบกำหนดชำระ
  - ระบบคำนวณยอดรวมอัตโนมัติ
- [ ] หน้ารายการบิล
  - กรองตามสาขา, เดือน, สถานะ
  - แสดงสถานะ (รอชำระ/ชำระแล้ว/เกินกำหนด)
- [ ] หน้าดูรายละเอียดบิล
  - แสดงรายการค่าใช้จ่ายทั้งหมด
  - แสดงประวัติการชำระ
- [ ] พิมพ์/ส่งบิลให้ผู้เช่า (PDF)
- [ ] ยกเลิกบิล

**เหตุผล:** ต้องออกบิลก่อนถึงจะรับชำระเงินได้

---

### 3.4 ระบบรับชำระเงิน (Payment Management)
- [ ] หน้ารับชำระเงิน
  - เลือกบิล/ผู้เช่า
  - กรอกจำนวนเงินที่รับ
  - เลือกวิธีการชำระ (เงินสด/โอน/บัตรเครดิต/พร้อมเพย์)
  - อัปโหลดสลิปโอนเงิน
  - ระบบคำนวณเงินทอน/เงินคงเหลือ
- [ ] หน้ารายการการชำระเงิน
- [ ] ตรวจสอบ/ยืนยันการชำระ (Verify Payment)
- [ ] ปฏิเสธการชำระ
- [ ] พิมพ์ใบเสร็จ

**เหตุผล:** หลังออกบิลแล้วต้องมีระบบรับเงิน

---

## 📋 Phase 4: ระบบสนับสนุน (Support & Reports)

### 4.1 ระบบแจ้งปัญหา (Issue Reporting)
- [ ] หน้าผู้เช่าแจ้งปัญหา
  - เลือกประเภทปัญหา (ซ่อมแซม/บำรุงรักษา/ร้องเรียน)
  - ระดับความสำคัญ (ต่ำ/กลาง/สูง/เร่งด่วน)
  - รายละเอียด
  - อัปโหลดรูปภาพ
- [ ] หน้ารายการปัญหา (สำหรับ Admin)
  - กรองตามสถานะ, สาขา, ประเภท
  - มอบหมายงาน (Assign)
  - เปลี่ยนสถานะ (รอดำเนินการ/กำลังดำเนินการ/เสร็จสิ้น)
- [ ] หน้าติดตามสถานะ (สำหรับผู้เช่า)

---

### 4.2 ระบบรายงาน (Reports & Analytics)
- [ ] Dashboard หน้าหลัก
  - สรุปรายได้รายเดือน
  - อัตราการเข้าพัก (Occupancy Rate)
  - บิลค่าเช่าค้างชำระ
  - ปัญหาที่รอดำเนินการ
- [ ] รายงานรายได้
  - รายได้รายวัน/รายเดือน/รายปี
  - แยกตามสาขา
  - กราฟแสดงแนวโน้ม
- [ ] รายงานห้องว่าง
- [ ] รายงานค่าใช้จ่าย
- [ ] รายงานผู้เช่าที่ค้างชำระ
- [ ] Export ข้อมูลเป็น Excel/PDF

---

## 📋 Phase 5: ระบบเพิ่มเติม (Optional - ทำทีหลังได้)

### 5.1 ระบบแจ้งเตือน (Notifications)
- [ ] แจ้งเตือนบิลใกล้ครบกำหนด
- [ ] แจ้งเตือนบิลเกินกำหนดชำระ
- [ ] แจ้งเตือนสัญญาใกล้หมดอายุ
- [ ] แจ้งเตือนปัญหาใหม่

### 5.2 Mobile App (ผู้เช่า)
- [ ] ดูบิลค่าเช่า
- [ ] แจ้งปัญหา
- [ ] ดูประวัติการชำระ
- [ ] รับ Notification

### 5.3 ระบบการจอง (Booking)
- [ ] ผู้เช่าจองห้องล่วงหน้า
- [ ] ชำระค่าจอง
- [ ] ยืนยัน/ปฏิเสธการจอง

---

## 🎯 สรุปลำดับที่แนะนำ

```
Phase 1 (สัปดาห์ที่ 1-2)
├─ 1. Login/Register
├─ 2. User Management
├─ 3. Branch Management ⭐
└─ 4. Room Master Data

Phase 2 (สัปดาห์ที่ 3-4)
├─ 5. Room Management ⭐
├─ 6. Tenant Management
└─ 7. Contract Management

Phase 3 (สัปดาห์ที่ 5-6) ⭐ ใจกลาง
├─ 8. Utility Settings
├─ 9. Meter Reading
├─ 10. Invoice Management
└─ 11. Payment Management

Phase 4 (สัปดาห์ที่ 7-8)
├─ 12. Issue Reporting
└─ 13. Reports & Dashboard

Phase 5 (ตามต้องการ)
└─ 14. Notifications, Mobile, Booking
```

---

## 💡 Tips การพัฒนา

1. **ทำให้ใช้งานได้จริงก่อน แล้วค่อยสวย** - Focus ที่ function ก่อน UI
2. **ทดสอบทุกหน้าก่อนไปหน้าถัดไป** - อย่าสะสมบั๊ก
3. **ใช้ข้อมูลจริงในการทดสอบ** - สร้าง seed data ที่สมจริง
4. **เก็บ screenshot ไว้** - เอาไว้ดูว่าทำไปถึงไหนแล้ว
5. **Backup database บ่อยๆ** - ก่อนทำการเปลี่ยนแปลงใหญ่

---

## ✅ Checklist ก่อนเริ่มแต่ละ Phase

- [ ] Database schema พร้อม
- [ ] API endpoints พร้อม  
- [ ] Mock data สำหรับทดสอบพร้อม
- [ ] UI/UX design พอเห็นภาพ
- [ ] เข้าใจ business logic แล้ว